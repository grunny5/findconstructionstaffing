# Test workflow to verify Jest test runner configuration
# This file tests that our CI pipeline properly runs tests with coverage

name: Test Jest Runner

on:
  workflow_dispatch:

jobs:
  test-jest-integration:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18.x'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Test Jest configuration
        run: |
          echo "Testing Jest configuration..."
          npm test -- --listTests --ci | head -20
          
      - name: Run tests with coverage
        run: |
          echo "Running tests with coverage..."
          npm test -- --coverage --ci --passWithNoTests || echo "Some tests failed (expected)"
          
      - name: Verify coverage output
        run: |
          echo "Checking coverage files..."
          test -d coverage && echo "✓ Coverage directory exists" || exit 1
          test -f coverage/lcov.info && echo "✓ LCOV report exists" || exit 1
          test -f coverage/coverage-final.json && echo "✓ JSON report exists" || exit 1
          
      - name: Display coverage summary
        run: |
          echo "Coverage Summary:"
          if [ -f coverage/lcov-report/index.html ]; then
            echo "✓ HTML report generated"
          fi
          # Show coverage text summary if available
          npm test -- --coverage --ci --coverageReporters="text-summary" --passWithNoTests || true